# Apache .htaccess configuration for KMOS Landing Page
# Deployed on GitHub Pages with custom domain kmos.in

# Enable RewriteEngine
RewriteEngine On

# ============================================
# GitHub Pages Base Path Configuration
# ============================================
# IMPORTANT: Adjust /kmos/ to match your repository name
# If your repo is named "kmos", keep /kmos/
# If your repo is named differently, change this path

RewriteBase /kmos/

# ============================================
# MIME Type Configuration - Critical Fix
# ============================================

# Explicitly set JavaScript MIME types to prevent text/html fallback
AddType application/javascript .js
AddType application/javascript .mjs
AddType text/javascript .js

# Ensure proper Content-Type headers for JavaScript files
<FilesMatch "\.(js|mjs)$">
    Header set Content-Type "application/javascript"
    Header set X-Content-Type-Options "nosniff"
</FilesMatch>

# Set CSS MIME type
AddType text/css .css

# ============================================
# SPA Fallback Configuration - Route all requests to index.html
# ============================================

# For Single Page Application (SPA) - serves index.html for all routes
# This must come AFTER file checks to allow actual files to be served

RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.*)$ /kmos/index.html [QSA,L]

# ============================================
# Cache Control Headers (Performance)
# ============================================

# Cache JavaScript files for 1 year (immutable - never revalidate)
<FilesMatch "\.(js|mjs)$">
    Header set Cache-Control "public, max-age=31536000, immutable"
</FilesMatch>

# Cache CSS files for 1 year
<FilesMatch "\.css$">
    Header set Cache-Control "public, max-age=31536000, immutable"
</FilesMatch>

# Cache images for 1 year
<FilesMatch "\.(png|jpg|jpeg|gif|svg|ico|webp)$">
    Header set Cache-Control "public, max-age=31536000, immutable"
</FilesMatch>

# Cache HTML files (shorter cache for updates)
<FilesMatch "\.html$">
    Header set Cache-Control "public, max-age=3600, must-revalidate"
</FilesMatch>

# ============================================
# Security Headers
# ============================================

# Prevent MIME type sniffing
Header set X-Content-Type-Options "nosniff"

# Basic security headers
Header set X-Frame-Options "SAMEORIGIN"
Header set X-XSS-Protection "1; mode=block"

# ============================================
# Gzip Compression
# ============================================

<IfModule mod_deflate.c>
    # Compress JavaScript
    AddOutputFilterByType DEFLATE application/javascript
    AddOutputFilterByType DEFLATE text/javascript
    
    # Compress CSS and HTML
    AddOutputFilterByType DEFLATE text/css
    AddOutputFilterByType DEFLATE text/html
    
    # Compress JSON and plain text
    AddOutputFilterByType DEFLATE application/json
    AddOutputFilterByType DEFLATE text/plain
    
    # Compress SVG images
    AddOutputFilterByType DEFLATE image/svg+xml
</IfModule>

# ============================================
# Force HTTPS (if using HTTPS on custom domain)
# ============================================

# Uncomment the following lines if you want to force HTTPS
# RewriteCond %{HTTPS} off
# RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]
